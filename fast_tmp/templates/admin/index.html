<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8"/>
    <title>index</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta
            name="viewport"
            content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge"/>
    <link rel="stylesheet" href="{{ static(path='sdk.css') }}"/>
    <style>
        html,
        body,
        .app-wrapper {
            position: relative;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<div id="root" class="app-wrapper"></div>
<script src="{{ static(path='sdk.js') }}"></script>
<script type="text/javascript">
    // const access_token="Bearer {{ access_token }}"
    (function () {
            let amis = amisRequire('amis/embed');
            // 通过替换下面这个配置来生成不同页面
            let amisScoped = amis.embed('#root', {% autoescape false %}{{ page }},{affixOffsetTop:0}{% endautoescape %}, {
                fetcher: ({url, method, data, config,header}) => {
                    config = config || {};
                    config.headers = headers || {};
                    config.headers["Authorization"]="Bearer {{ access_token }}"
                    if (config.cancelExecutor) {
                        config.cancelToken = new axios.CancelToken(config.cancelExecutor);
                    }
                    if (data && data instanceof FormData) {
                        // config.headers = config.headers || {};
                        // config.headers['Content-Type'] = 'multipart/form-data';
                    } else if (
                        data &&
                        typeof data !== 'string' &&
                        !(data instanceof Blob) &&
                        !(data instanceof ArrayBuffer)
                    ) {
                        data = JSON.stringify(data);
                        config.headers['Content-Type'] = 'application/json';
                    }

                    if (method !== 'post' && method !== 'put' && method !== 'patch') {
                        if (data) {
                            if (method === 'delete') {
                                config.data = data;
                            } else {
                                config.params = data;
                            }
                        }
                        return axios[method](url, config);
                    }
                    return axios[method](url, data, config);
                }
            })
        }
    )();

</script>
</body>
</html>